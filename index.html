<!DOCTYPE HTML>
<html>
<head>
    <title>Compiler</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="dist/styles/compiler.css" />
    <link rel="stylesheet" href="dist/styles/bootstrap.min.css">
</head>
<body>
    <div id="divButtonBar" style="margin:15px;">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <span>Prisc<strong>OS</strong> Compiler</span>
                    <button type="button" class="btn btn-primary navbar-btn"
                            style="margin-left: 5px;"
                            onclick="compile();">
                        Compile
                    </button>
                </div>
            </div>
        </nav>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="source-code-container col-sm-6">
                <h3 style="padding-left: 10px;">Source Code</h3>
                <textarea id="source-code" style="resize: none;"></textarea>
            </div>
            <div class="log-output-container col-sm-6">
                <h3 style="padding-left: 10px;">Log</h3>
                <textarea id="log-output" style="resize: none;" readonly></textarea>
            </div>
        </div>
        <div class="row">
            <div style="height: 300px;" class="tokens col-sm-6">
                <h3 style="padding-left: 10px;">Tokens</h3>
                <div style="overflow:scroll; height:300px;">
                    <table id="tokens-table" style="width: 100%;"
                           class="table table-condensed table-hover table-bordered">
                        <tr>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Line Number</th>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="test-programs col-sm-6">
                <h3 style="padding-left: 10px;">Test Programs</h3>
                <div style="overflow:scroll; height:300px;">
                    <table id="programs-table" style="width: 100%;" class="table borderless">
                        <tr>
                            <td><button type="button" class="btn btn-primary" onclick="nestedWhile();">Nested While</button></td>
                            <td style="vertical-align: middle;">Tests a valid program in the grammar.</td>
                        </tr>
                        <tr>
                            <td><button type="button" class="btn btn-primary" onclick="basicProgram();">Basic Program</button></td>
                            <td style="vertical-align: middle;">Tests the most basic program the language can consist of.</td>
                        </tr>
                        <tr>
                            <td><button type="button" class="btn btn-primary" onclick="everything();">Entire Grammar</button></td>
                            <td style="vertical-align: middle;">Tests the entire grammar in one program.</td>
                        </tr>
                        <tr>
                            <td><button type="button" class="btn btn-warning" onclick="missingEoP();">Missing $$$</button></td>
                            <td style="vertical-align: middle;">Tests a program without an End of Program character.</td>
                        </tr>
                        <tr>
                            <td><button type="button" class="btn btn-danger" onclick="invalidSymbol();">Invalid Symbol</button></td>
                            <td style="vertical-align: middle;">Tests a program with an invalid character.</td>
                        </tr>
                        <tr>
                            <td><button type="button" class="btn btn-danger" onclick="newLineString();">\n in String</button></td>
                            <td style="vertical-align: middle;">Tests a program with a new line in a string.</td>
                        </tr>
                        <tr>
                            <td><button type="button" class="btn btn-danger" onclick="unexpectedToken();">Unexpected Token</button></td>
                            <td style="vertical-align: middle;">Tests a program that doesn't conform to the grammar.</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="footer" style="height:100px;"></div>

    <!-- Client-side code down here, per the YSlow advice. 
         (http://developer.yahoo.com/performance/rules.html#js_bottom) -->
    <script type="text/javascript" src="dist/scripts/utils.js"></script>	
    <script type="text/javascript" src="dist/scripts/lexer.js"></script>
    <script type="text/javascript" src="dist/scripts/parser.js"></script>
    <script type="text/javascript" src="dist/scripts/logger.js"></script>
    <script type="text/javascript" src="dist/scripts/token.js"></script>
	<script type="text/javascript" src="dist/scripts/globals.js"></script>
    <script type="text/javascript">
    
    function compile() {
        // Reset globals
        _Tokens = [];
        _CurrentToken = null;
        _TokenIndex = 0;
        document.getElementById("log-output").value = "";
        this.clearTokensTable();

        if (document.getElementById("source-code").value === '') {
            _Logger.logMessage("Try putting some code in there!");
            return;
        }

        // Grab the tokens from the lexer . . .
        _Lexer.lex();
        // . . . and parse!

        _Logger.logMessage("Lexical analysis successful.");

        // This will allow us to parse multiple programs.
        // Not very useful in Project One, but possibly in the future?
        while (_TokenIndex < _Tokens.length) {
            _Parser.parse();
        }
    }

    function clearTokensTable() {
        var table = document.getElementById('tokens-table');
        var length = table.rows.length;

        if (length > 1) {
            // Remove rows from the bottom up
            // Otherwise, they'll be removed out of order or some will be skipped
            for (var i = length - 1; i > 0; i--) {
                table.deleteRow(i);
            }
        }
    }

    function missingEoP() {
        document.getElementById('source-code').value = '{ \n  int a \n  a = 2 \n  print(a) \n} ';
        compile();
    }

    function nestedWhile() {
        document.getElementById('source-code').value = '';
        compile();
    }

    function invalidSymbol() {
        document.getElementById('source-code').value = '{ \n  int a \n  a = 2 \n  print(a - 2) \n} $';
        compile();
    }

    function everything() {
        document.getElementById('source-code').value = '';
        compile();
    }

    function basicProgram() {
        document.getElementById('source-code').value = '{}$';
        compile();
    }

    function newLineString() {
        document.getElementById('source-code').value = '{\n  string a\n  a = \"str\ning\"\n  print(a)\n} $';
        compile();
    }

    function unexpectedToken() {
        document.getElementById('source-code').value = '{\n  int a\n  a == 5 + 1\n  print(a)\n} $';
        compile();
    }

    </script>
</body>
</html>